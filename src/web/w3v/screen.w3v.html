- компонент для всего экрана
<main as="app-root">
    <h1 style="height:80px;width:100%;position:fixed;left:0; top:0;z-index: 10;min-width: 400px;padding-left: 40px;">
        Анализ Workflow</h1>
    <div style="margin-top:80px;">
        <table style="width: 100%;">
            <tr style="vertical-align: top;">
                <td style="height:300px;">
                    <div ref="source" style="width:100%;height:100%;"></div>
                <td style="width:100px;height:300px;">
                    <array-iterator ref="controls">
                        <control-button></control-button>
                    </array-iterator>
                    <div style="padding: 20px 5px 0 5px; font-size: 16px;;">
                        Вставь xml в поле слева и нажми на одну из кнопок
                    </div>
                </td>
                <td class="report">
                    <report-box ref="report" class="report"></report-boxv>
                </td>
            </tr>
        </table>
        <div ref="chartView"></div>
    </div>
    <script>
        const editor = ace.edit(this.ref.source)

        editor.setTheme("ace/theme/monokai")
        editor.session.setMode("ace/mode/xml")
        this.ref.source.style.fontSize = '14px';
        this.ref.source.style.fontFamily = "'Courier New', Courier, monospace'"

        this.ref.controls.setData(appContext.buttons, {
            target: this.ref.chartView,
            reportTarget: this.ref.report,
            editor
        })
    </script>
</main>

- кнопка
<button as="control-button">
    <script>
        const typeMap = {
            canvas: 'img-container',
            svg: 'svg-container'
        }
        const parser = new DOMParser()
        /**
         * 
         * @param {
         *  {
         *    title: string;
         *    action: (doc: DOMNode) => DOMNode;
         *  }
         * } button описание кнопки
         * @param {
         *  {
         *      target: Node;
         *      reportTarget: Node;
         *      editor: {getValue: ()=>string}
         *  }
         * } options - настройки - место для картинки и источник данных для рисования
         * */
        this.onSetData = (button, options) => {
            this.innerHTML = button.title
            this.onclick = () => {
                Array.prototype.slice.call(options.target.children).forEach(
                    (e) => {
                        e.destroy()
                    }
                )
                options.reportTarget.setData()

                const source = options.editor.getValue()
                if (!source?.trim()) {
                    return
                }

                const xml = parser.parseFromString(source, 'text/xml')
                const element = button.action(xml)
                const container = factory.create(typeMap[element.tagName.toLowerCase()])

                container.mount(options.target)
                options.reportTarget.setData(element.report)

                container.setData(element)
            }
        }

    </script>
</button>

- контейнер для canvas
<div as="img-container" style="background-color: #FFFFFF;">
    <container-controls ref="controls"></container-controls>
    <script>
        this.onSetData = (element) => {
            element.style.width = '100%'
            this.appendChild(element)
        }
    </script>
</div>
- контейнер для svg
<div as="svg-container" style="background-color: #FFFFFF;">
    <container-controls ref="controls"></container-controls>
    <script>
        let width
        let height

        this.onSetData = (svg) => {
            width = svg.getAttribute('width') * 1
            height = svg.getAttribute('height') * 1

            this.appendChild(svg)

            let scaleIt = () => scaleTo(svg, this)

            window.addEventListener('resize', scaleIt)

            this.onDestroy = () => {
                window.removeEventListener('resize', scaleIt)
            }

            scaleTo(svg, this)

        }

        const scaleTo = (svg, target) => {

            let scale = target.offsetWidth / width || 1

            let dx = Math.floor((target.offsetWidth - width))
            let dy = Math.floor((scale * height - height))

            svg.setAttribute('viewBox', [0, 0, width, scale < 1 ? height / scale : height].join(' '))

            svg.setAttribute('width', target.offsetWidth)

            // this.ref.panel.innerText = dx + ' x ' + dy + ' (' + scale + ') '
        }

    </script>
    <!-- <div ref="panel" style="position:absolute; z-index: 100;color:black;"></div> -->
</div>
- кнопки для контейнеров (canvas и svg)
<div as="container-controls" style="position: relative;">
    <div style="position: absolute; right: 30px; top: 20px;">
        <!-- <button ref="copy" style="font-size: 20px;height: 40px;width: 40px;">copy</button> -->
        <!-- <button ref="expand" style="font-size: 30px;height: 40px;width: 40px;">+</button> -->
    </div>
</div>

- панель для отчёта
<div as="report-box">
    <div ref="box">
        <h3 style="margin:0 0 10px;">Отчёт</h3>

        <h4>Состояния</h4>
        <array-iterator usetag="div" ref="states">
            <report-row usetag="div"></report-row>
        </array-iterator>

        <h4>Переходы</h4>
        <array-iterator usetag="div" ref="joins">
            <report-row usetag="div"></report-row>
        </array-iterator>
    </div>
    <script>
        const words = {
            states: {
                count: 'Количество общее',
                decision: 'Разветвителей',
                process: 'Процессов',
                interactive: 'Интерактивных',
                external: 'Внешних вызовов',
                unused: 'Количество не достижимых',
                unusedList: 'Недостижимы'
            },
            joins: {
                total: "Количество общее",
                badTargets: "Выходов в отсутствующие состояния",
                terminatorStates: "Состояний без переходов",
                terminators: "Выходов из процесса"
            }
        }

        this.ref.box.style.display = 'none'

        this.onSetData = (report) => {
            this.ref.box.style.display = ''
            if (!report) {
                this.ref.box.style.display = 'none'
            }
            const statesReport = report?.states?.filter((row) => !!row?.value)
            this.ref.states.setData(statesReport, words.states)

            const joinsReport = report?.joins?.filter((row) => !!row?.value)
            this.ref.joins.setData(joinsReport, words.joins)
        }

    </script>
</div>

- строка отчёта
<div as="report-row">
    <div tagname="span" ref="title"></div>
    <div tagname="span" ref="value" style="padding-left:10px;font-weight: bold;"></div>
    <script>
        this.onSetData = (row, words) => {
            this.ref.title.innerText = (words[row?.name] || row?.name) + ':'
            this.ref.value.innerText = row?.value
        }
    </script>
</div>